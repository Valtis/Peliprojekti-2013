# initialize statics that are shared between functions
(statics invTimeLeft owningEntity)

# register function onDamageTaken as callback when entity takes damage
# parameters: pointer to the entity, pointer to the VMState. 
(fn initialize (entity state)
  (
    (setvalue invTimeLeft 0)
    (setvalue owningEntity entity)
    (invokenative "RegisterMessageHandler" entity state 10 4 "onDamageTaken")  
  )
)


(fn update (ticksPassed) (
  (if (> invTimeLeft 0)
    (
      (setvalue invTimeLeft (- invTimeLeft ticksPassed))
    )  
  )
))

(fn onDamageTaken (message)
  (
  (if (= invTimeLeft 0)
    (
      (setvalue invTimeLeft 60)
      (invokenative "SendBlinkMessage" owningEntity invTimeLeft)
      (return 0)
    )
    ((return 1))
  )
  )
)